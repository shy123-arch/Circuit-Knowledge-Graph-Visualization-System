# 知识图谱科学构建模块功能说明

## 概述

本项目包含四个核心模块，分别负责知识图谱构建的不同阶段。下面详细说明每个模块的作用。

---

## 模块一：kg_extraction.py - 知识抽取模块

### 🎯 核心作用
**从非结构化文本中自动提取知识点（实体）和关系**

### 📋 主要功能

1. **实体识别（Entity Recognition）**
   - 从文本中识别知识点实体
   - 使用三种匹配方法：
     - **精确匹配**：直接匹配实体名称（置信度0.9）
     - **关键词匹配**：通过关键词匹配实体（置信度0.6）
     - **部分匹配**：部分名称匹配（置信度0.4）

2. **关系抽取（Relation Extraction）**
   - 从文本中提取实体间的关系
   - 支持5种关系类型：
     - `包含`：如"电路包含电阻"
     - `基于`：如"基尔霍夫定律基于欧姆定律"
     - `应用`：如"滤波器应用于信号处理"
     - `类型`：如"运算放大器是差分放大器"
     - `扩展`：如"模拟电路扩展为数字电路"

3. **实体词典构建**
   - 从现有知识图谱构建实体词典
   - 包含实体的ID、标题、描述、关键词等信息

### 🔄 运行后的作用

**输入**：一段文本
```
"运算放大器是一种高增益、直接耦合的差分放大器。基尔霍夫定律基于欧姆定律。"
```

**输出**：
- **提取的实体**：
  - 运算放大器 (ID: xxx, 置信度: 0.9)
  - 差分放大器 (ID: xxx, 置信度: 0.9)
  - 基尔霍夫定律 (ID: xxx, 置信度: 0.9)
  - 欧姆定律 (ID: xxx, 置信度: 0.9)

- **提取的关系**：
  - (运算放大器, 类型, 差分放大器) 置信度: 0.7
  - (基尔霍夫定律, 基于, 欧姆定律) 置信度: 0.7

### 💡 在知识图谱构建中的作用
- **节点创建阶段**：自动识别新知识点
- **关系创建阶段**：自动提取知识点间的关系
- **知识图谱扩展**：从新文本中提取知识，扩展知识图谱

---

## 模块二：kg_embedding.py - 知识图谱嵌入模块

### 🎯 核心作用
**将知识图谱中的实体和关系映射到低维向量空间，学习它们的向量表示**

### 📋 主要功能

1. **TransE模型实现**
   - 核心思想：`h + r ≈ t`（头实体+关系≈尾实体）
   - 将每个实体和关系映射为50维向量
   - 通过训练学习实体和关系的语义表示

2. **实体ID映射**
   - 将不连续的实体ID（1-499）映射到连续索引（0-191）
   - 解决PyTorch嵌入层需要连续索引的问题

3. **模型训练**
   - 使用Margin-based ranking loss训练
   - 生成负样本（随机替换头或尾实体）
   - 训练100个epoch，学习实体和关系的向量表示

4. **实体相似度计算**
   - 计算两个实体嵌入向量的余弦相似度
   - 用于推荐相关概念

### 🔄 运行后的作用

**训练过程**：
1. 加载知识图谱数据（192个节点，191条边）
2. 构建实体和关系的映射关系
3. 准备训练三元组（h, r, t）
4. 训练TransE模型（100 epochs，约3-5分钟）
5. 保存训练好的模型到`models/trained_model.pkl`

**训练结果**：
- 每个实体都有一个50维的向量表示
- 每种关系都有一个50维的向量表示
- 这些向量捕获了实体和关系的语义信息

### 💡 在知识图谱构建中的作用
- **向量化表示**：将知识图谱转换为数值向量，便于计算
- **语义理解**：学习实体和关系的语义关系
- **为后续任务提供基础**：链接预测、相似度计算等都需要嵌入向量

---

## 模块三：kg_completion.py - 知识图谱补全模块

### 🎯 核心作用
**基于训练好的嵌入模型，预测知识图谱中缺失的关系，补全知识图谱**

### 📋 主要功能

1. **关系预测（Link Prediction）**
   - 预测两个实体之间最可能的关系
   - 使用TransE模型计算实体对的关系得分
   - 返回置信度最高的前k个关系

2. **缺失链接发现**
   - 对所有可能的实体对进行预测
   - 筛选置信度高于阈值的关系
   - 自动发现知识图谱中可能缺失的链接

3. **相关概念推荐**
   - 基于嵌入向量计算实体相似度
   - 推荐与给定实体最相关的概念
   - 用于学习路径规划

4. **链接预测评估**
   - 评估模型在链接预测任务上的性能
   - 计算Top-1和Top-K准确率

### 🔄 运行后的作用

**关系预测示例**：
- **输入**：实体1="欧姆定律"，实体2="基尔霍夫定律"
- **输出**：
  - 预测关系="基于"（置信度：0.82）
  - 预测关系="相关"（置信度：0.65）
  - 预测关系="扩展"（置信度：0.45）

**缺失链接发现**：
- **输入**：知识图谱（192节点，191条边）
- **输出**：发现20个可能缺失的链接，例如：
  - (节点A, 基于, 节点B) 置信度: 0.75
  - (节点C, 包含, 节点D) 置信度: 0.68
  - ...

**相关概念推荐**：
- **输入**：实体="欧姆定律"
- **输出**：推荐10个相关概念
  - 基尔霍夫定律（相似度：0.85）
  - 电路分析（相似度：0.78）
  - ...

### 💡 在知识图谱构建中的作用
- **关系补全**：发现和补全缺失的关系，提高知识图谱完整性
- **质量提升**：通过链接预测可以提升知识图谱完整性30%+
- **知识发现**：发现潜在的知识点关联

---

## 模块四：train_model.py - 模型训练脚本

### 🎯 核心作用
**一键训练知识图谱嵌入模型，并保存供后续使用**

### 📋 主要功能

1. **数据加载和预处理**
   - 加载知识图谱数据
   - 构建关系映射
   - 构建实体ID映射

2. **模型训练**
   - 创建TransE模型
   - 训练模型（100 epochs）
   - 保存训练好的模型

3. **模型测试**
   - 测试模型的关系预测功能
   - 验证模型训练效果

### 🔄 运行后的作用

**运行命令**：
```bash
python train_model.py
```

**运行过程**：
1. 加载知识图谱数据（192节点，191边）
2. 构建关系映射（29种关系类型）
3. 构建实体ID映射
4. 准备训练数据（191个三元组）
5. 创建TransE模型（192实体，29关系，50维嵌入）
6. 训练模型（100 epochs，约3-5分钟）
7. 保存模型到`models/trained_model.pkl`
8. 测试模型预测效果

**运行结果**：
- 生成训练好的模型文件：`models/trained_model.pkl`
- 包含模型、映射关系、嵌入向量等所有信息
- 模型可以在Flask应用中使用

### 💡 在知识图谱构建中的作用
- **模型准备**：为知识图谱补全提供训练好的模型
- **一次性训练**：首次使用前必须运行，后续可直接使用保存的模型
- **模型更新**：当知识图谱更新后，可以重新训练模型

---

## 四个模块的协作关系

```
┌─────────────────────────────────────────────────────────┐
│              知识图谱构建流程                            │
└─────────────────────────────────────────────────────────┘

1. kg_extraction.py (知识抽取)
   ↓
   从文本提取实体和关系
   ↓
2. train_model.py (模型训练)
   ↓
   训练TransE嵌入模型
   ↓
3. kg_embedding.py (嵌入学习)
   ↓
   学习实体和关系的向量表示
   ↓
4. kg_completion.py (知识补全)
   ↓
   预测缺失关系，补全知识图谱
```

### 工作流程

1. **初始构建阶段**：
   - 使用`kg_extraction.py`从文本中提取初始知识
   - 构建基础知识图谱

2. **模型训练阶段**：
   - 运行`train_model.py`训练嵌入模型
   - 模型学习知识图谱的语义表示

3. **知识补全阶段**：
   - 使用`kg_completion.py`预测缺失关系
   - 补全知识图谱，提高完整性

4. **持续优化阶段**：
   - 使用`kg_extraction.py`提取新知识
   - 重新训练模型（`train_model.py`）
   - 使用`kg_completion.py`补全新知识

---

## 实际应用场景

### 场景1：从教材文本构建知识图谱
1. **输入**：教材文本
2. **使用kg_extraction.py**：提取知识点和关系
3. **使用train_model.py**：训练嵌入模型
4. **使用kg_completion.py**：补全缺失关系
5. **输出**：完整的知识图谱

### 场景2：扩展现有知识图谱
1. **输入**：新文本（如新章节）
2. **使用kg_extraction.py**：提取新知识点
3. **使用kg_completion.py**：预测新知识点与现有知识点的关系
4. **输出**：扩展后的知识图谱

### 场景3：发现知识关联
1. **输入**：一个知识点（如"欧姆定律"）
2. **使用kg_completion.py**：推荐相关概念
3. **输出**：相关知识点列表，用于学习路径规划

---

## 总结

| 模块 | 主要作用 | 输入 | 输出 | 运行时机 |
|------|---------|------|------|---------|
| **kg_extraction.py** | 知识抽取 | 文本 | 实体+关系 | 需要从文本提取知识时 |
| **kg_embedding.py** | 嵌入学习 | 知识图谱 | 向量表示 | 被train_model.py调用 |
| **kg_completion.py** | 知识补全 | 知识图谱+模型 | 预测关系 | 需要补全知识图谱时 |
| **train_model.py** | 模型训练 | 知识图谱 | 训练好的模型 | 首次使用前必须运行 |

这四个模块共同构成了一个完整的知识图谱科学构建系统，从知识抽取到知识补全，实现了知识图谱的半自动化构建。

